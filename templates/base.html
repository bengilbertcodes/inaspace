{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<meta name="description" content="A Room Booking Application" />
	<meta name="author" content="Ben Gilbert" />
	<title>inaspace - Book Your Room</title>
	<!-- Favicon -->
	<link rel="icon" type="image/x-icon" href="{% static 'assets/favicon.ico' %}" />
	{% block extra_css %}
	<!-- Core theme CSS (includes Bootstrap) -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<!-- css for DataTables -->
	<link rel="stylesheet" href="https://cdn.datatables.net/2.1.2/css/dataTables.dataTables.css" />
	<!-- css for timepicker -->
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/jquery-timepicker/1.13.18/jquery.timepicker.min.css" />
	<link href="{% static 'css/styles.css' %}" rel="stylesheet" />
	{% endblock %}
</head>

<body>
	{% include 'includes/header.html' %}

	{% if messages %}
	<div class="alert-container">
		{% for message in messages %}
		<div class="alert alert-dismissible {{ message.tags }} message-box" role="alert">
			<div>{{ message | safe }}</div>
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
		{% endfor %}
	</div>
	{% endif %}

	<main>
		{% block content %}
		{% endblock %}
	</main>

	{% include 'includes/footer.html' %}

{% block extra_js %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<!-- Bootstrap core JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'js/scripts.js' %}"></script>
<!-- js for timepicker -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-timepicker/1.13.18/jquery.timepicker.min.js"></script>
<!-- js for DataTables -->
<script src="https://cdn.datatables.net/2.1.2/js/dataTables.js"></script>
{% endblock%}

<script>
	// scripts to setup DataTable
	$(document).ready(function () {
		$('#bookings-table').DataTable();
	});


	// Custom date sorting plugin
		$.fn.dataTable.ext.type.order['date-dd-mmm-yyyy-pre'] = function (d) {
			var parts = d.split(' ');
			var day = parts[0];
			var month = parts[1];
			var year = parts[2];
			var months = {
				"Jan": "01",
				"Feb": "02",
				"Mar": "03",
				"Apr": "04",
				"May": "05",
				"Jun": "06",
				"Jul": "07",
				"Aug": "08",
				"Sep": "09",
				"Oct": "10",
				"Nov": "11",
				"Dec": "12"
			};
			return Date.parse(year + '-' + months[month] + '-' + day);
		};

		// Initialize DataTable
		$('#bookings-table').DataTable({
			"columnDefs": [
				{ "type": "date-dd-mmm-yyyy", "targets": 1 },
				{ "orderable": false, "targets": [ 3, 4] }
			],
			"order": [[1, 'asc']]
		});



	// scipts to set up timepicker
	$(document).ready(function () {
			// Initialize time pickers
			$('#id_start_time').timepicker({
				'timeFormat': 'H:i',
				'step': 15,
				'minTime': '08:00',
				'maxTime': '21:45'
			});


			$('#id_end_time').timepicker({
				'timeFormat': 'H:i',
				'step': 15,
				'minTime': '08:15',
				'maxTime': '22:00'
			});


			// Set end_time default to start_time + 1 hour
			$('#id_start_time').on('changeTime', function () {
				var startTime = $(this).timepicker('getTime');
				if (startTime) {
					var endTime = new Date(startTime.getTime() + 60 * 60 * 1000); // add 1 hour
					$('#id_end_time').timepicker('setTime', endTime);
				}
			});


			// Ensure date cannot be in the past
			$('#id_date').on('change', function () {
				var selectedDate = new Date($(this).val());
				var today = new Date();
				today.setHours(0, 0, 0, 0); // Normalize today's date to midnight


				if (selectedDate < today) {
					alert('Date cannot be in the past');
					$(this).val('');
				}
			});
		});
</script>

</body>

</html>